# About skopeo 

FROM almalinux:9
# current Dockerfile allow you install packages from Russia with truenetwork repos

# Отключаем стандартные репозитории (если нужно)
RUN sed -i 's/enabled=1/enabled=0/' /etc/yum.repos.d/almalinux-appstream.repo
RUN sed -i 's/enabled=1/enabled=0/' /etc/yum.repos.d/almalinux-baseos.repo
RUN sed -i 's/enabled=1/enabled=0/' /etc/yum.repos.d/almalinux-extras.repo

# Создаём файл репозитория Truenetwork BaseOS
RUN echo '[truenetwork-BaseOS]' > /etc/yum.repos.d/truenetworkBaseOS.repo && \
    echo 'name=AlmaLinux Mirror by Truenetwork' >> /etc/yum.repos.d/truenetworkBaseOS.repo && \
    # Исправленный baseurl (убираем лишнее /repodata/)
    echo 'baseurl=https://mirror.truenetwork.ru/almalinux/9/BaseOS/x86_64/os/' >> /etc/yum.repos.d/truenetworkBaseOS.repo && \
    echo 'enabled=1' >> /etc/yum.repos.d/truenetworkBaseOS.repo && \
    echo 'gpgcheck=1' >> /etc/yum.repos.d/truenetworkBaseOS.repo && \
    echo 'gpgkey=https://mirror.truenetwork.ru/almalinux/9/BaseOS/x86_64/os/RPM-GPG-KEY-AlmaLinux-9' >> /etc/yum.repos.d/truenetworkBaseOS.repo

# Создаём файл репозитория Truenetwork AppStream
RUN echo '[truenetwork-AppStream]' > /etc/yum.repos.d/truenetworkAppStream.repo && \
    echo 'name=AlmaLinux Mirror by Truenetwork' >> /etc/yum.repos.d/truenetworkAppStream.repo && \
    # Исправленный baseurl (убираем лишнее /repodata/)
    echo 'baseurl=https://mirror.truenetwork.ru/almalinux/9/AppStream/x86_64/os/' >> /etc/yum.repos.d/truenetworkAppStream.repo && \
    echo 'enabled=1' >> /etc/yum.repos.d/truenetworkAppStream.repo && \
    echo 'gpgcheck=1' >> /etc/yum.repos.d/truenetworkAppStream.repo && \
    echo 'gpgkey=https://mirror.truenetwork.ru/almalinux/9/AppStream/x86_64/os/RPM-GPG-KEY-AlmaLinux-9' >> /etc/yum.repos.d/truenetworkAppStream.repo

# Обновляем кэш метаданных (теперь должно сработать)
RUN dnf makecache --refresh


# Устанавливаем пакеты
RUN dnf update -y && \
    dnf install -y \
        skopeo \
        procps-ng \
        net-tools \
        wget \
        ca-certificates && \
    dnf clean all && \
    rm -rf /var/cache/dnf


# Проверка установленных утилит
RUN skopeo --version && \
    ps --version && \
    ifconfig -v


CMD ["/bin/bash"]

### About an errors ###
# If you get an error FATA[0000] Error parsing image name
such error appear if you have a problem with certs

skopeo inspect   docker://registry.apps.<your-domain>/alpine/alpine:3.22.1
FATA[0000] Error parsing image name "docker://registry.apps.<your-domain>/alpine/alpine:3.22.1": pinging container registry registry.apps.k<your-domain>: Get "https://registry.apps.<your-domain>/v2/": tls: failed to verify certificate: x509: certificate signed by unknown authority

if add --tls-verify=false
skopeo inspect --tls-verify=false  docker://registry.apps.<your-domain>/alpine/alpine:3.22.1 
it will provide you json with data

### skopeo debug ###
skopeo --debug  inspect  --cert-dir /etc/kubernetes/   docker://registry.apps.<your-domain>/alpine/alpine:3.22.1
DEBU[0000] Using registries.d directory /etc/containers/registries.d
DEBU[0000] Loading registries configuration "/etc/containers/registries.conf"
DEBU[0000] Loading registries configuration "/etc/containers/registries.conf.d/000-shortnames.conf"
....


